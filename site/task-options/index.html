
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Python task queue using Redis.">
      
      
      
      
        <link rel="canonical" href="https://tasktiger-docs.ritza.github.io/task-options/">
      
      
        
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.2+insiders-2.12.2">
    
    
      
        <title>Task options - TaskTiger</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.98acb380.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.73e53a79.min.css">
        
          
          
          <meta name="theme-color" content="#ff6e42">
        
      
      <link rel="preload" as="style" href="../assets/stylesheets/vendor/mermaid.733f213f.min.css">
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    <script>function __md_scope(e,t,_){return new URL(_||(t===localStorage?"..":".."),location).pathname+"."+e}function __md_get(e,t=localStorage,_){return JSON.parse(t.getItem(__md_scope(e,t,_)))}function __md_set(e,t,_=localStorage,o){try{_.setItem(__md_scope(e,_,o),JSON.stringify(t))}catch(e){}}</script>
    
      


    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="deep-orange" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#task-options" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="TaskTiger" class="md-header__button md-logo" aria-label="TaskTiger" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TaskTiger
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Task options
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link md-tabs__link--active">
        Home
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="TaskTiger" class="md-nav__button md-logo" aria-label="TaskTiger" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    TaskTiger
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--container ">
          <a href="..">Home</a>
          <label for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
          </label>
        </div>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quick-start/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../task-decorator/" class="md-nav__link">
        Task decorator
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Task options
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Task options
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#task-options" class="md-nav__link">
    Task options
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../custom-retrying/" class="md-nav__link">
        Custom retrying
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workers/" class="md-nav__link">
        Worker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../inspect-requeue-delete-tasks/" class="md-nav__link">
        Inspect, requeue and delete tasks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pause-queue-processing/" class="md-nav__link">
        Pause queue processing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rollbar-error-handling/" class="md-nav__link">
        Rollbar error handling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cleaning-up-errored-tasks/" class="md-nav__link">
        Cleaning Up Error'd Tasks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../running-test-suite/" class="md-nav__link">
        Running The Test Suite
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../releasing-a-new-version/" class="md-nav__link">
        Releasing a New Version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#task-options" class="md-nav__link">
    Task options
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                
                  <h1>Task options</h1>
                
                <h2 id="task-options">Task options</h2>
<p>Tasks support a variety of options that can be specified either in the
task decorator, or when queueing a task. For the latter, the <code>delay</code>
method must be called on the <code>TaskTiger</code> object, and any options in the
task decorator are overridden.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@tiger</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">queue</span><span class="o">=</span><span class="s1">&#39;myqueue&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_task</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># The task will be queued in &quot;otherqueue&quot;, even though the task decorator</span>
<span class="c1"># says &quot;myqueue&quot;.</span>
<span class="n">tiger</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">my_task</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="s1">&#39;otherqueue&#39;</span><span class="p">)</span>
</code></pre></div>
<p>When queueing a task, the task needs to be defined in a module other
than the Python file which is being executed. In other words, the task
can\'t be in the <code>__main__</code> module. TaskTiger will give you back an
error otherwise.</p>
<p>The following options are supported by both <code>delay</code> and the task
decorator:</p>
<ul>
<li>
<p><code>queue</code></p>
<p>Name of the queue where the task will be queued.</p>
</li>
<li>
<p><code>hard_timeout</code></p>
<p>If the task runs longer than the given number of seconds, it will be
killed and marked as failed.</p>
</li>
<li>
<p><code>unique</code></p>
<p>Boolean to indicate whether the task will only be queued if there is
no similar task with the same function, arguments, and keyword
arguments in the queue. Note that multiple similar tasks may still
be executed at the same time since the task will still be inserted
into the queue if another one is being processed. Requeueing an
already scheduled unique task will not change the time it was
originally scheduled to execute at.</p>
</li>
<li>
<p><code>unique_key</code></p>
<p>If set, this implies <code>unique=True</code> and specifies the list of kwargs
to use to construct the unique key. By default, all args and kwargs
are serialized and hashed.</p>
</li>
<li>
<p><code>lock</code></p>
<p>Boolean to indicate whether to hold a lock while the task is being
executed (for the given args and kwargs). If a task with similar
args/kwargs is queued and tries to acquire the lock, it will be
retried later.</p>
</li>
<li>
<p><code>lock_key</code></p>
<p>If set, this implies <code>lock=True</code> and specifies the list of kwargs to
use to construct the lock key. By default, all args and kwargs are
serialized and hashed.</p>
</li>
<li>
<p><code>max_queue_size</code></p>
<p>A maximum queue size can be enforced by setting this to an integer
value. The <code>QueueFullException</code> exception will be raised when
queuing a task if this limit is reached. Tasks in the <code>active</code>,
<code>scheduled</code>, and <code>queued</code> states are counted against this limit.</p>
</li>
<li>
<p><code>when</code></p>
<p>Takes either a datetime (for an absolute date) or a timedelta
(relative to now). If given, the task will be scheduled for the
given time.</p>
</li>
<li>
<p><code>retry</code></p>
<p>Boolean to indicate whether to retry the task when it fails (either
because of an exception or because of a timeout). To restrict the
list of failures, use <code>retry_on</code>. Unless <code>retry_method</code> is given,
the configured <code>DEFAULT_RETRY_METHOD</code> is used.</p>
</li>
<li>
<p><code>retry_on</code></p>
<p>If a list is given, it implies <code>retry=True</code>. The task will be only
retried on the given exceptions (or its subclasses). To retry the
task when a hard timeout occurs, use <code>JobTimeoutException</code>.</p>
</li>
<li>
<p><code>retry_method</code></p>
<p>If given, implies <code>retry=True</code>. Pass either:</p>
<ul>
<li>a function that takes the retry number as an argument, or,</li>
<li>a tuple <code>(f, args)</code>, where <code>f</code> takes the retry number as the
    first argument, followed by the additional args.</li>
</ul>
<p>The function needs to return the desired retry interval in seconds,
or raise <code>StopRetry</code> to stop retrying. The following built-in
functions can be passed for common scenarios and return the
appropriate tuple:</p>
<ul>
<li>
<p><code>fixed(delay, max_retries)</code></p>
<p>Returns a method that returns the given <code>delay</code> (in seconds) or
raises <code>StopRetry</code> if the number of retries exceeds
<code>max_retries</code>.</p>
</li>
<li>
<p><code>linear(delay, increment, max_retries)</code></p>
<p>Like <code>fixed</code>, but starts off with the given <code>delay</code> and
increments it by the given <code>increment</code> after every retry.</p>
</li>
<li>
<p><code>exponential(delay, factor, max_retries)</code></p>
<p>Like <code>fixed</code>, but starts off with the given <code>delay</code> and
multiplies it by the given <code>factor</code> after every retry.</p>
</li>
</ul>
<p>For example, to retry a task 3 times (for a total of 4 executions),
and wait 60 seconds between executions, pass
<code>retry_method=fixed(60, 3)</code>.</p>
</li>
<li>
<p><code>runner_class</code></p>
<p>If given, a Python class can be specified to influence task running
behavior. The runner class should inherit
<code>tasktiger.runner.BaseRunner</code> and implement the task execution
behavior. The default implementation is available in
<code>tasktiger.runner.DefaultRunner</code>. The following behavior can be
achieved:</p>
<ul>
<li>
<p>Execute specific code before or after the task is executed (in
    the forked child process), or customize the way task functions
    are called in either single or batch processing.</p>
<p>Note that if you want to execute specific code for all tasks,
you should use the <code>CHILD_CONTEXT_MANAGERS</code> configuration
option.</p>
</li>
<li>
<p>Control the hard timeout behavior of a task.</p>
</li>
<li>
<p>Execute specific code in the main worker process after a task
    failed permanently.</p>
</li>
</ul>
<p>This is an advanced feature and the interface and requirements of
the runner class can change in future TaskTiger versions.</p>
</li>
</ul>
<p>The following options can be only specified in the task decorator:</p>
<ul>
<li>
<p><code>batch</code></p>
<p>If set to <code>True</code>, the task will receive a list of dicts with args
and kwargs and can process multiple tasks of the same type at once.
Example:
<code>[{"args": [1], "kwargs": {}}, {"args": [2], "kwargs": {}}]</code> Note
that the list will only contain multiple items if the worker has set
up <code>BATCH_QUEUES</code> for the specific queue (see the <em>Configuration</em>
section).</p>
</li>
<li>
<p><code>schedule</code></p>
<p>If given, makes a task execute periodically. Pass either:</p>
<ul>
<li>a function that takes the current datetime as an argument.</li>
<li>a tuple <code>(f, args)</code>, where <code>f</code> takes the current datetime as the
    first argument, followed by the additional args.</li>
</ul>
<p>The schedule function must return the next task execution datetime,
or <code>None</code> to prevent periodic execution. The function is executed to
determine the initial task execution date when a worker is
initialized, and to determine the next execution date when the task
is about to get executed.</p>
<p>For most common scenarios, the <code>periodic</code> built-in function can be
passed:</p>
<ul>
<li>
<p><code>periodic(seconds=0, minutes=0, hours=0, days=0, weeks=0, start_date=None, end_date=None)</code></p>
<p>Use equal, periodic intervals, starting from <code>start_date</code>
(defaults to <code>2000-01-01T00:00Z</code>, a Saturday, if not given),
ending at <code>end_date</code> (or never, if not given). For example, to
run a task every five minutes indefinitely, use
<code>schedule=periodic(minutes=5)</code>. To run a task every every Sunday
at 4am UTC, you could use
<code>schedule=periodic(weeks=1, start_date=datetime.datetime(2000, 1, 2, 4))</code>.</p>
</li>
</ul>
</li>
</ul>
                
              
              
                


              
            </article>
            
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../task-decorator/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Task decorator" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Task decorator
            </div>
          </div>
        </a>
      
      
        
        <a href="../custom-retrying/" class="md-footer__link md-footer__link--next" aria-label="Next: Custom retrying" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Custom retrying
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.indexes", "navigation.tabs", "navigation.sections"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.61ac8e46.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.218b5f82.min.js"></script>
      
    
  </body>
</html>